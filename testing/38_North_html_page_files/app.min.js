var util={getCookie:function(c_name){if(document.cookie.length>0){var c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;var c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""},setCookie:function(c_name,value,expiredays){var exdate=new Date;exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+(expiredays==null?"":"; expires="+exdate.toUTCString())+"; path=/"},checkCookie:function(c_name){c_name=util.getCookie(c_name);return c_name!=null&&c_name!=""?true:false},getQueryParam:function(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "))},openWindowCentered:function(url,title,w,h){var dualScreenLeft=window.screenLeft!=undefined?window.screenLeft:screen.left;var dualScreenTop=window.screenTop!=undefined?window.screenTop:screen.top;var width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var left=width/2-w/2+dualScreenLeft;var top=height/2-h/2+dualScreenTop;var newWindow=window.open(url,title,"scrollbars=yes, width="+w+", height="+h+", top="+top+", left="+left);if(window.focus){newWindow.focus()}},addLoader:function(target){target.prepend('<div class="loader">Loading<span>...</span></div>')},removeLoader:function(target){target.find(".loader").remove()},updatePushState:function(ajaxData,action,filterValues){var params="";var pagePathParts=String(ajaxData.rewrite_base).slice(1,-1).split("/");var pagePath=ajaxData.rewrite_base;var title=document.title;switch(action){case"search":params+="?s="+filterValues.s;if(filterValues.post_type){for(var i=0;i<filterValues.post_type.length;i++){params+="&post_type[]="+filterValues.post_type[i]}}title="You searched for "+filterValues.s+" | 38 North";break;case"get_resources":pagePath+=0!=filterValues.resource_type?"types/"+filterValues.resource_type+"/":"";break;case"get_press":pagePath+=0!=filterValues.press_type?"types/"+filterValues.press_type+"/":"";break;case"get_affiliate_articles":pagePath+=0!=filterValues.affiliate?"site/"+filterValues.affiliate+"/":"";break;case"get_tag_articles":break;case"get_articles":default:if("articles"==pagePathParts[0]){pagePath=0!=filterValues.topic?"/topics/"+filterValues.topic+"/":"/articles/"}else{params+=0!=filterValues.topic?"?topic="+filterValues.topic:""}break}if(ajaxData.paged>1){pagePath+="page/"+ajaxData.paged+"/"}try{history.pushState({ajaxData:ajaxData,filterValues:filterValues},title,pagePath+params);dataLayer.push({event:"Virtual Pageview",pageview_path:pagePath+params,pageview_title:title})}catch(err){}},displayAjaxResults:function(data,$target,delay){var i=0;var interval=setInterval(function(){if(i<=data.length){$target.append(data[i]);i++}else{$target.css("min-height","");util.setupAjaxPagination();clearInterval(interval)}},delay)},processAjaxFilters:function($filterObj,pageNum,values){var $this=$filterObj;var paged=pageNum?pageNum:1;var $target=jQuery($this.data("ajax-target"));var $formBtns=$this.find("button");var action=$this.data("ajax-action");if(!values){var values={};jQuery.each($this.serializeArray(),function(i,field){if(field.name.indexOf("[]")!==-1){var fieldName=field.name.replace("[]","");if(typeof values[fieldName]==="undefined"){values[fieldName]=[]}values[fieldName].push(field.value)}else{values[field.name]=field.value}})}else{for(var key in values){if(values.hasOwnProperty(key)){$("#"+$filterObj.attr("id")+'*[name="'+key+'"]').val(values[key])}}}var ajaxData={filter:"#"+$this.attr("id"),action:app_localized.namespace+"_"+(action?action:"get_articles"),check:app_localized.check,rewrite_base:$this.attr("action"),paged:paged,s:values.s};switch(action){case"get_authors":ajaxData["s"]=values.search;break;case"get_press":ajaxData["press_type"]=values.press_type;break;case"get_resources":ajaxData["resource_type"]=values.resource_type;break;case"search":ajaxData["loop_type"]=$target.data("ajax-loop-type");ajaxData["post_type"]=values.post_type;break;case"get_affiliate_articles":ajaxData["loop_type"]=$target.data("ajax-loop-type");ajaxData["affiliate"]=values.affiliate;break;case"get_tag_articles":ajaxData["tag"]=$this.data("ajax-tag");break;case"get_articles":default:ajaxData["author"]=$this.data("ajax-author");ajaxData["loop_type"]=$target.data("ajax-loop-type");ajaxData["topic"]=values.topic;break}jQuery.ajax({url:app_localized.ajaxurl,dataType:"json",data:ajaxData,success:function(data){util.removeLoader($target);util.displayAjaxResults(data,$target,75);util.updatePushState(ajaxData,action,values);$formBtns.prop("disabled",false)},error:function(jqXHR,textStatus,errorThrown){util.removeLoader($target);$target.append('<div class="ajax-item margin-v text-center lead">An error was encountered during the request.</div>')},beforeSend:function(){jQuery("html, body").animate({scrollTop:jQuery(ajaxData.filter).offset().top},250);$target.css("min-height",$target.outerHeight()+"px").empty();util.addLoader($target);$formBtns.prop("disabled",true)}})},setupAjaxPagination:function(){var $pagination=jQuery(".pagination[data-ajax-paginates]");var $paginationLinks=jQuery(".pagination[data-ajax-paginates] a");var $filterForm=jQuery($pagination.data("ajax-paginates"));$paginationLinks.on("click",function(e){e.preventDefault();var $this=jQuery(this);var clickText=$this.text().replace("Go to page ","");var pageNum;switch(clickText){case"Next":pageNum=parseInt($this.siblings(".current").text().replace("Go to page ",""))+1;break;case"Prev":pageNum=parseInt($this.siblings(".current").text().replace("Go to page ",""))-1;break;default:pageNum=clickText;break}util.processAjaxFilters($filterForm,pageNum)})}};jQuery(document).ready(function($){FastClick.attach(document.body);var $win=$(window);var $body=$("body");$(".masthead").headroom({offset:40});var $mastheadNav=$(".masthead__nav");var $mastheadNavToggle=$("#mastheadNavToggle");$mastheadNavToggle.on("click",function(e){e.preventDefault();var $this=$(this);var $close=$mastheadSearchToggles.add($mastheadSearch);$this.toggleClass("is-open");$body.toggleClass("mobile-nav-open");$close.removeClass("is-open");$mastheadNav.toggleClass("is-open")});$mastheadNav.find("li").hover(function(){if($(this).find(".sub-menu").length)$(this).addClass("hovered")},function(){$(this).removeClass("hovered")});$(".mobile-subnav-toggle").on("click",function(){var $this=$(this);$this.toggleClass("is-open")});var $mastheadSearchToggles=$(".mastheadSearchToggle, .nav__item--search > a");var $mastheadSearch=$(".masthead__search");var $mastheadSearchInput=$mastheadSearch.find('input[type="search"]');$mastheadSearchInput.on("focusin focus",function(e){e.preventDefault()});$mastheadSearchToggles.on("click",function(e){e.preventDefault();var $this=$(this);var $close=$mastheadNavToggle.add($mastheadNav);$body.toggleClass("search-open");$this.toggleClass("is-open");$close.removeClass("is-open");$mastheadSearch.toggleClass("is-open")});$("button.browserupgrade__close").on("click",function(e){e.preventDefault();$("#browserupgrade").remove();util.setCookie(app_localized.namespace+"_"+"browserupgrade","closed")});$("body").on("click","a.top-link",function(e){e.preventDefault();$("html, body").animate({scrollTop:0},250)});var $ajaxForms=$("form[data-ajax-action]");var $selectFilters=$('select[name="topic"], select[name="affiliate"]');util.setupAjaxPagination();$selectFilters.on("change",function(){$(this).parents("form[data-ajax-action]").submit()});$ajaxForms.on("submit",function(e){e.preventDefault();util.processAjaxFilters($(this))});$("[data-open-window]").on("click",function(e){e.preventDefault();var $this=$(this);util.openWindowCentered($this.attr("href"),$this.attr("title"),$this.data("win-width"),$this.data("win-height"))});var $twtrWidgets=$(".tweets");$twtrWidgets.each(function(){var $this=$(this);var $target=$this.find(".tweets__target");$.ajax({url:app_localized.ajaxurl,dataType:"json",data:{action:"three8n_get_tweets",check:app_localized.check},success:function(data){var count=$this.data("twtr-count");if(data!==null&&typeof data==="object"){util.removeLoader($target);for(var i=0;i<count;i++){$target.append('<article class="tweet ajax-item"><div class="tweet__meta">'+'<time class="tweet__date" datetime="'+data[i].created_at_full+'">'+data[i].created_at_short+"</time>"+"</div>"+'<div class="tweet__body">'+data[i].text+"</div></article>")}$.fn.matchHeight._update()}},error:function(){util.removeLoader($target)},beforeSend:function(){util.addLoader($target)}})});var $slideshows=$(".slideshow");var $imageEnlargeBtn=$(".slideshow__enlarge");var $imageEnlargeModal=$("#image-enlarge-modal");$slideshows.slick({slide:"figure",rows:0,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slideshow__arrow slideshow__arrow--prev"><span class="sr-only">Previous</span></button>',nextArrow:'<button type="button" class="slideshow__arrow slideshow__arrow--next"><span class="sr-only">Next</span></button>'}).on("init setPosition afterChange",function(){$(".slick-arrow").css("height",$(".slick-current img").outerHeight()+"px")});$slideshows.on({afterChange:function(event,slick,currentSlide,nextSlide){var $this=$(this);var $activeSlide=$this.find(".slideshow__slide").eq(currentSlide+1);if(true==$activeSlide.data("enlargeable")){var activeSlideId=$activeSlide.data("attachment-id");$imageEnlargeBtn.data("attachment-id",activeSlideId);$imageEnlargeBtn.attr("data-attachment-id",activeSlideId);$imageEnlargeBtn.show()}else{$imageEnlargeBtn.hide()}}});$imageEnlargeBtn.on("click",function(){var $this=$(this);var attachmentId=$this.data("attachment-id");if(attachmentId){$.ajax({url:app_localized.ajaxurl,dataType:"json",data:{action:app_localized.namespace+"_get_attachment",check:app_localized.check,attachment_id:parseInt(attachmentId)},success:function(data){$imageEnlargeModal.find(".modal-content").html('<img src="'+data.src[0]+'" role="presentation" class="img-responsive">');$imageEnlargeModal.modal("show")},error:function(jqXHR,textStatus,errorThrown){},beforeSend:function(){}})}});$("#showComments").on("click",function(e){e.preventDefault();var $this=$(this);var btnText=$this.text();if(btnText.indexOf("Show")>-1){$this.text(btnText.replace("Show","Hide"))}else if(btnText.indexOf("Hide")>-1){$this.text(btnText.replace("Hide","Show"))}$("#comments").toggle()});if(!app_localized.logged_in)$("body").on("contextmenu","img",function(e){return false})});if(Modernizr.touchevents||Modernizr.pointerevents){document.addEventListener("gesturestart",function(e){e.preventDefault()});var lastTouchEnd=0;document.documentElement.addEventListener("touchend",function(e){var now=(new Date).getTime();if(now-lastTouchEnd<=300){e.preventDefault()}lastTouchEnd=now},false)}var youtubeTargets=document.querySelectorAll(".ytvideo__player");if(youtubeTargets.length){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}var youtubePlayers=[];function onYouTubePlayerAPIReady(){for(var i=0;i<youtubeTargets.length;i++){var startTime=youtubeTargets[i].getAttribute("data-yt-video-start-time")?youtubeTargets[i].getAttribute("data-yt-video-start-time"):0;youtubePlayers[youtubeTargets[i].getAttribute("data-yt-video-id")]=new YT.Player(youtubeTargets[i].id,{videoId:youtubeTargets[i].getAttribute("data-yt-video-id"),height:"390",width:"640",playerVars:{start:startTime,rel:0,showinfo:0,origin:app_localized.origin}})}}